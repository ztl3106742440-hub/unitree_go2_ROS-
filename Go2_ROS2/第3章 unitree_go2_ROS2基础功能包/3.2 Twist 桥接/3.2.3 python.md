colcon build --packages-select go2_twist_bridge_py
. install/setup.bash
ros2 run go2_twist_bridge_py twist_bridge

ros2 run teleop_twist_keyboard teleop_twist_keyboard


1. 在 /home/ztl/unitree_go2_ws/src/base/go2_twist_bridge_py/go2_twist_bridge_py 下，创建 sport_model.py ，内容如下
```
# 定义常量字典

ROBOT_SPORT_API_IDS = {

"DAMP": 1001, # 阻尼控制

"BALANCESTAND": 1002, # 平衡站立

"STOPMOVE": 1003, # 停止运动

"STANDUP": 1004, # 站立

"STANDDOWN": 1005, # 站立下降

"RECOVERYSTAND": 1006, # 恢复站立

"EULER": 1007, # 欧拉角控制

"MOVE": 1008, # 移动

"SIT": 1009, # 坐下

"RISESIT": 1010, # 从坐下恢复站立

"SWITCHGAIT": 1011, # 切换步态

"TRIGGER": 1012, # 触发

"BODYHEIGHT": 1013, # 身体高度调整

"FOOTRAISEHEIGHT": 1014, # 脚部抬起高度调整

"SPEEDLEVEL": 1015, # 速度级别调整

"HELLO": 1016, # 打招呼

"STRETCH": 1017, # 伸展

"TRAJECTORYFOLLOW": 1018, # 轨迹跟随

"CONTINUOUSGAIT": 1019, # 连续步态

"CONTENT": 1020, # 内容

"WALLOW": 1021, # 打滚

"DANCE1": 1022, # 舞蹈1

"DANCE2": 1023, # 舞蹈2

"GETBODYHEIGHT": 1024, # 获取身体高度

"GETFOOTRAISEHEIGHT": 1025, # 获取脚部抬起高度

"GETSPEEDLEVEL": 1026, # 获取速度级别

"SWITCHJOYSTICK": 1027, # 切换操纵杆

"POSE": 1028, # 姿态

"SCRAPE": 1029, # 刮擦

"FRONTFLIP": 1030, # 前空翻

"FRONTJUMP": 1031, # 前跳

"FRONTPOUNCE": 1032 # 前扑

}
```

2. 编写 twist_bridge.py :
```
'''

订阅twist消息，并转换为go2所需的request消息来控制

实现：

1.Request发布对象

2.twist订阅对象

3.在回调函数中转换消息并发布

  

'''

  

import rclpy

from rclpy.node import Node

from unitree_api.msg import Request

from geometry_msgs.msg import Twist

from .sport_model import ROBOT_SPORT_API_IDS

import json

  

class TwistBridge(Node):

def __init__(self):

super().__init__('twist_bridge')

# 1.Request发布对象

self.request_pub = self.create_publisher(Request,"/api/sport/request",10)

# 2.twist订阅对象

self.twist_sub = self.create_subscription(Twist,"cmd_vel",self.twist_cb,10)

  

def twist_cb(self,twist):

# 3.在回调函数中转换消息并发布

request = Request()

x = twist.linear.x

y = twist.linear.y

z = twist.angular.z

# 设置api_id

api_id = ROBOT_SPORT_API_IDS["BALANCESTAND"]

if x != 0 or y != 0 or z != 0:

api_id = ROBOT_SPORT_API_IDS["MOVE"]

# 设置参数

js = {"x": x, "y": y, "z": z}

request.parameter = json.dumps(js)

  

request.header.identity.api_id = api_id

self.request_pub.publish(request)

  

def main():

rclpy.init()

rclpy.spin(TwistBridge())

rclpy.shutdown()

  

if __name__ == '__main__':

main()
```

运行：
colcon build --packages-select go2_twist_bridge_py
. install/setup.bash
ros2 run go2_twist_bridge_py twist_bridge

终端二：
ros2 run teleop_twist_keyboard teleop_twist_keyboard
